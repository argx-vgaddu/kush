1                                         The SAS System           15:51 Monday, September 22, 2025

NOTE: Copyright (c) 2023 by SAS Institute Inc., Cary, NC, USA. 
NOTE: SAS (r) Proprietary Software 9.4 (TS1M8) 
      Licensed to ARGENX VIA OCS_ANALYTICS PRO & ACCPCFF_35 USERS, Site 70225139.
NOTE: This session is executing on the X64_WIN+PRO  platform.



NOTE: Analytical products:
      
      SAS/STAT 15.3

NOTE: Additional host information:

 X64_WIN+PRO WIN 10.0.26100  Workstation

NOTE: SAS initialization used:
      real time           4.63 seconds
      cpu time            0.56 seconds
      
1          /******************************************************************************
2           * ADAPTIVE CLINICAL TRIAL SIMULATION WITH CONDITIONAL POWER - BASE SAS LOCAL VERSION
3           *
4           * Purpose: This program simulates a two-stage adaptive clinical trial design
5           *          with interim analysis based on conditional power calculations.
6           *
7           * This is the local SAS version with hardcoded local paths.
8           *
9           * Key Features:
10          * - Stage 1: Initial trial with fixed sample size
11          * - Interim Analysis: Conditional power calculation to determine next steps
12          * - Stage 2: Continuation with potentially adapted sample size
13          * - Operating Characteristics: Power, sample size, and region probabilities
14          *
15          * Author: Vikas Gaddu
16          * Date: 2025-09-22
17          * Version: 1.0 - Local SAS Implementation with common setup
18          ******************************************************************************/
19         x 'cd C:\sas\kush'
19       !                   ;
20         %include "setup.sas";
NOTE: Loading common simulation setup...
NOTE: Common setup loaded successfully.
NOTE: Sample size parameters - Nst1: 50, Nst2: 50, Nmax: 75
NOTE: Simulation iterations: 1
NOTE: Statistical boundaries - Cst1: 3.586925, Cst2: 1.960395
74         
75         /*=============================================================================
76          * SECTION 1: LOCAL FILE PATHS
77          * Define local file paths for this environment
78          *============================================================================*/
79         
80         /* File paths for input data and output results */
81         %let data_path = C:\sas\kush\data;
2                                         The SAS System           15:51 Monday, September 22, 2025

82         %let output_path = C:\sas\kush\output;
83         
84         /* Input correlation data files */
85         %let file1 = &data_path\simdata1.csv;  /* Treatment group 0 correlation structure */
86         %let file2 = &data_path\simdata2.csv;  /* Treatment group 1 correlation structure */
87         
88         /*=============================================================================
89          * SECTION 2: MACRO DEFINITIONS (Same as original)
90          *============================================================================*/
91         
92         /**
93          * MACRO: simulate_and_process
94          * Purpose: Generate simulated multivariate normal data and transform to long format
95          *          for a single treatment group
96          */
97         %macro simulate_and_process(
98             input_data=,
99             output_prefix=,
100            seed=,
101            nst=,
102            iter=,
103            sid_offset=0,
104            trt_value=
105        );
106            /* Step 1: Generate multivariate normal data preserving correlation structure */
107            proc simnormal data=&input_data
108                           outsim=&output_prefix
109                           numreal=%sysevalf(&nst*&iter)
110                           seed=&seed;
111                var y1-y10;  /* 10 time points */
112            run;
113        
114            /* Step 2: Create iteration and subject identifiers */
115            data &output_prefix._sid;
116                set &output_prefix;
117                iterID = floor((_N_-1) / &nst) + 1;  /* Iteration number */
118        
119                /* Calculate subject ID with optional offset */
120                %if &sid_offset > 0 %then %do;
121                    SID = mod(rnum, &nst) + &sid_offset + 1;
122                %end;
123                %else %do;
124                    SID = mod(rnum, &nst) + 1;
125                %end;
126        
127                drop rnum;
128            run;
129        
130            /* Step 3: Sort for transpose */
131            proc sort data=&output_prefix._sid;
132                by iterID SID;
133            run;
134        
3                                         The SAS System           15:51 Monday, September 22, 2025

135            /* Step 4: Reshape from wide to long format */
136            proc transpose data=&output_prefix._sid
137                           out=&output_prefix._long;
138                by iterID SID;
139                var y1-y10;
140            run;
141        
142            /* Step 5: Add time and treatment variables */
143            data &output_prefix._long_t;
144                set &output_prefix._long (rename=(col1=y));
145                t = input(substr(_name_, 2), 2.);  /* Extract time point (1-10) */
146                visit = cat("t", input(substr(_name_, 2), 2.));  /* Visit label */
147                trt = &trt_value;  /* Treatment assignment */
148                drop _name_;
149            run;
150        
151        %mend simulate_and_process;
152        
153        /**
154         * MACRO: combine_and_calculate_change
155         * Purpose: Combine two treatment groups and calculate change from baseline
156         */
157        %macro combine_and_calculate_change(
158            dbs1_prefix=,
159            dbs2_prefix=,
160            output_data=
161        );
162            /* Combine both treatment groups */
163            data sim_dbs_long_t_comb;
164                set &dbs1_prefix._long_t &dbs2_prefix._long_t;
165            run;
166        
167            /* Extract baseline values (t=1) */
168            data sim_dbs_long_t_bsl;
169                set sim_dbs_long_t_comb;
170                if t = 1;  /* Keep only baseline observations */
171                rename y = bsl;
172            run;
173        
174            /* Sort for merge */
175            proc sort data=sim_dbs_long_t_comb;
176                by SID iterID;
177            run;
178        
179            proc sort data=sim_dbs_long_t_bsl;
180                by SID iterID;
181            run;
182        
183            /* Merge baseline with all timepoints */
184            data sim_dbs_long_t_comb_bsl;
185                merge sim_dbs_long_t_comb sim_dbs_long_t_bsl;
186                by SID iterID;
187            run;
4                                         The SAS System           15:51 Monday, September 22, 2025

188        
189            /* Calculate change from baseline */
190            data &output_data;
191                set sim_dbs_long_t_comb_bsl;
192                chg = y - bsl;  /* Change from baseline */
193                if t = 1 then chg = .;  /* No change at baseline */
194            run;
195        
196            /* Final sort */
197            proc sort data=&output_data;
198                by iterID SID;
199            run;
200        
201            /* Clean up temporary datasets */
202            proc delete data=sim_dbs_long_t_comb
203                             sim_dbs_long_t_bsl
204                             sim_dbs_long_t_comb_bsl;
205            run;
206        
207        %mend combine_and_calculate_change;
208        
209        /**
210         * MACRO: simdatst2
211         * Purpose: Simulate Stage 2 data for each iteration based on Stage 1 results
212         */
213        %macro simdatst2;
214            %do icnt = 1 %to &iter;
215                %let n2st2 = 0;
216        
217                /* Get Stage 2 sample size from Stage 1 results */
218                data _null_;
219                    set res1a;
220                    if iterID = &icnt then
221                        call symput('n2st2', trim(left(put(N2new, 4.))));
222                run;
223        
224                /* Generate iteration-specific seeds */
225                %let sed1 = %sysfunc(ceil(&seed12i + 10*&icnt));
226                %let sed2 = %sysfunc(ceil(&seed22i + 3*&icnt));
227        
228                /* Simulate both treatment groups for this iteration */
229                %simulate_and_process(
230                    input_data=dbsim1c,
231                    output_prefix=sim_dbs1_iter&icnt,
232                    seed=&sed1,
233                    nst=&nst2,
234                    iter=1,
235                    sid_offset=0,
236                    trt_value=0
237                );
238        
239                %simulate_and_process(
240                    input_data=dbsim2c,
5                                         The SAS System           15:51 Monday, September 22, 2025

241                    output_prefix=sim_dbs2_iter&icnt,
242                    seed=&sed2,
243                    nst=&nst2,
244                    iter=1,
245                    sid_offset=&nst2,
246                    trt_value=1
247                );
248        
249                /* Combine groups and calculate change from baseline */
250                %combine_and_calculate_change(
251                    dbs1_prefix=sim_dbs1_iter&icnt,
252                    dbs2_prefix=sim_dbs2_iter&icnt,
253                    output_data=dat_stg2iter&icnt
254                );
255        
256                /* Add iteration ID */
257                data dat_stg2iter&icnt;
258                    set dat_stg2iter&icnt;
259                    iterID = &icnt;
260                run;
261        
262                /* Append to main Stage 2 dataset */
263                data dat_stg2;
264                    set dat_stg2 dat_stg2iter&icnt;
265                run;
266        
267                /* Clean up iteration-specific datasets */
268                proc delete data=dat_stg2iter&icnt
269                                sim_dbs1_iter&icnt
270                                sim_dbs2_iter&icnt
271                                sim_dbs1_iter&icnt._sid
272                                sim_dbs2_iter&icnt._sid
273                                sim_dbs1_iter&icnt._long
274                                sim_dbs2_iter&icnt._long
275                                sim_dbs1_iter&icnt._long_t
276                                sim_dbs2_iter&icnt._long_t;
277                run;
278            %end;
279        %mend simdatst2;
280        
281        /*=============================================================================
282         * SECTION 3: MAIN SIMULATION EXECUTION (Same logic, local paths)
283         *============================================================================*/
284        
285        /*-----------------------------------------------------------------------------
286         * STAGE 1: DATA PREPARATION AND INITIAL SIMULATION
287         *----------------------------------------------------------------------------*/
288        
289        /* Import correlation data from CSV files */
290        proc import datafile="&file1"
291                    DBMS=csv
292                    OUT=dbsim1;
293        run;
6                                         The SAS System           15:51 Monday, September 22, 2025


294         /**********************************************************************
295         *   PRODUCT:   SAS
296         *   VERSION:   9.4
297         *   CREATOR:   External File Interface
298         *   DATE:      22SEP25
299         *   DESC:      Generated SAS Datastep Code
300         *   TEMPLATE SOURCE:  (None Specified.)
301         ***********************************************************************/
302            data WORK.DBSIM1    ;
303            %let _EFIERR_ = 0; /* set the ERROR detection macro variable */
304            infile 'C:\sas\kush\data\simdata1.csv' delimiter = ',' MISSOVER DSD lrecl=32767
304      ! firstobs=2 ;
305               informat _TYPE_ $4. ;
306               informat _NAME_ $3. ;
307               informat y1 best32. ;
308               informat y2 best32. ;
309               informat y3 best32. ;
310               informat y4 best32. ;
311               informat y5 best32. ;
312               informat y6 best32. ;
313               informat y7 best32. ;
314               informat y8 best32. ;
315               informat y9 best32. ;
316               informat y10 best32. ;
317               format _TYPE_ $4. ;
318               format _NAME_ $3. ;
319               format y1 best12. ;
320               format y2 best12. ;
321               format y3 best12. ;
322               format y4 best12. ;
323               format y5 best12. ;
324               format y6 best12. ;
325               format y7 best12. ;
326               format y8 best12. ;
327               format y9 best12. ;
328               format y10 best12. ;
329            input
330                        _TYPE_  $
331                        _NAME_  $
332                        y1
333                        y2
334                        y3
335                        y4
336                        y5
337                        y6
338                        y7
339                        y8
340                        y9
341                        y10
342            ;
343            if _ERROR_ then call symputx('_EFIERR_',1);  /* set ERROR detection macro variable
343      ! */
7                                         The SAS System           15:51 Monday, September 22, 2025

344            run;

NOTE: The infile 'C:\sas\kush\data\simdata1.csv' is:
      Filename=C:\sas\kush\data\simdata1.csv,
      RECFM=V,LRECL=32767,File Size (bytes)=1085,
      Last Modified=22Sep2025:15:04:53,
      Create Time=22Sep2025:15:04:51

NOTE: 12 records were read from the infile 'C:\sas\kush\data\simdata1.csv'.
      The minimum record length was 79.
      The maximum record length was 91.
NOTE: The data set WORK.DBSIM1 has 12 observations and 12 variables.
NOTE: DATA statement used (Total process time):
      real time           0.27 seconds
      cpu time            0.00 seconds
      

12 rows created in WORK.DBSIM1 from C:\sas\kush\data\simdata1.csv.
  
  
  
NOTE: WORK.DBSIM1 data set was successfully created.
NOTE: The data set WORK.DBSIM1 has 12 observations and 12 variables.
NOTE: PROCEDURE IMPORT used (Total process time):
      real time           2.03 seconds
      cpu time            0.04 seconds
      

345        
346        proc import datafile="&file2"
347                    DBMS=csv
348                    OUT=dbsim2;
349        run;

350         /**********************************************************************
351         *   PRODUCT:   SAS
352         *   VERSION:   9.4
353         *   CREATOR:   External File Interface
354         *   DATE:      22SEP25
355         *   DESC:      Generated SAS Datastep Code
356         *   TEMPLATE SOURCE:  (None Specified.)
357         ***********************************************************************/
358            data WORK.DBSIM2    ;
359            %let _EFIERR_ = 0; /* set the ERROR detection macro variable */
360            infile 'C:\sas\kush\data\simdata2.csv' delimiter = ',' MISSOVER DSD lrecl=32767
360      ! firstobs=2 ;
361               informat _TYPE_ $4. ;
362               informat _NAME_ $3. ;
363               informat y1 best32. ;
364               informat y2 best32. ;
365               informat y3 best32. ;
366               informat y4 best32. ;
367               informat y5 best32. ;
8                                         The SAS System           15:51 Monday, September 22, 2025

368               informat y6 best32. ;
369               informat y7 best32. ;
370               informat y8 best32. ;
371               informat y9 best32. ;
372               informat y10 best32. ;
373               format _TYPE_ $4. ;
374               format _NAME_ $3. ;
375               format y1 best12. ;
376               format y2 best12. ;
377               format y3 best12. ;
378               format y4 best12. ;
379               format y5 best12. ;
380               format y6 best12. ;
381               format y7 best12. ;
382               format y8 best12. ;
383               format y9 best12. ;
384               format y10 best12. ;
385            input
386                        _TYPE_  $
387                        _NAME_  $
388                        y1
389                        y2
390                        y3
391                        y4
392                        y5
393                        y6
394                        y7
395                        y8
396                        y9
397                        y10
398            ;
399            if _ERROR_ then call symputx('_EFIERR_',1);  /* set ERROR detection macro variable
399      ! */
400            run;

NOTE: The infile 'C:\sas\kush\data\simdata2.csv' is:
      Filename=C:\sas\kush\data\simdata2.csv,
      RECFM=V,LRECL=32767,File Size (bytes)=1085,
      Last Modified=22Sep2025:15:05:20,
      Create Time=22Sep2025:15:05:18

NOTE: 12 records were read from the infile 'C:\sas\kush\data\simdata2.csv'.
      The minimum record length was 79.
      The maximum record length was 91.
NOTE: The data set WORK.DBSIM2 has 12 observations and 12 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

12 rows created in WORK.DBSIM2 from C:\sas\kush\data\simdata2.csv.
  
  
9                                         The SAS System           15:51 Monday, September 22, 2025

  
NOTE: WORK.DBSIM2 data set was successfully created.
NOTE: The data set WORK.DBSIM2 has 12 observations and 12 variables.
NOTE: PROCEDURE IMPORT used (Total process time):
      real time           0.04 seconds
      cpu time            0.03 seconds
      

401        
402        /* Create correlation datasets for simulation */
403        data dbsim1c(type=corr);
404            set dbsim1;
405        run;

NOTE: There were 12 observations read from the data set WORK.DBSIM1.
NOTE: The data set WORK.DBSIM1C has 12 observations and 12 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

406        
407        data dbsim2c(type=corr);
408            set dbsim2;
409        run;

NOTE: There were 12 observations read from the data set WORK.DBSIM2.
NOTE: The data set WORK.DBSIM2C has 12 observations and 12 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      

410        
411        /* Generate Stage 1 simulated data - Call macro twice */
412        %simulate_and_process(
413            input_data=dbsim1c,
414            output_prefix=sim_dbs1,
415            seed=&seed11i,
416            nst=&nst1,
417            iter=&iter,
418            sid_offset=0,
419            trt_value=0
420        );

NOTE: The data set WORK.SIM_DBS1 has 50 observations and 11 variables.
NOTE: PROCEDURE SIMNORMAL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


NOTE: There were 50 observations read from the data set WORK.SIM_DBS1.
10                                        The SAS System           15:51 Monday, September 22, 2025

NOTE: The data set WORK.SIM_DBS1_SID has 50 observations and 12 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      


NOTE: There were 50 observations read from the data set WORK.SIM_DBS1_SID.
NOTE: The data set WORK.SIM_DBS1_SID has 50 observations and 12 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.03 seconds
      cpu time            0.00 seconds
      


NOTE: There were 50 observations read from the data set WORK.SIM_DBS1_SID.
NOTE: The data set WORK.SIM_DBS1_LONG has 500 observations and 4 variables.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.07 seconds
      cpu time            0.01 seconds
      


NOTE: There were 500 observations read from the data set WORK.SIM_DBS1_LONG.
NOTE: The data set WORK.SIM_DBS1_LONG_T has 500 observations and 6 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.00 seconds
      

421        
422        %simulate_and_process(
423            input_data=dbsim2c,
424            output_prefix=sim_dbs2,
425            seed=&seed21i,
426            nst=&nst1,
427            iter=&iter,
428            sid_offset=&nst1,
429            trt_value=1
430        );

NOTE: The data set WORK.SIM_DBS2 has 50 observations and 11 variables.
NOTE: PROCEDURE SIMNORMAL used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      


NOTE: There were 50 observations read from the data set WORK.SIM_DBS2.
NOTE: The data set WORK.SIM_DBS2_SID has 50 observations and 12 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
11                                        The SAS System           15:51 Monday, September 22, 2025

      


NOTE: There were 50 observations read from the data set WORK.SIM_DBS2_SID.
NOTE: The data set WORK.SIM_DBS2_SID has 50 observations and 12 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      


NOTE: There were 50 observations read from the data set WORK.SIM_DBS2_SID.
NOTE: The data set WORK.SIM_DBS2_LONG has 500 observations and 4 variables.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.03 seconds
      cpu time            0.01 seconds
      


NOTE: There were 500 observations read from the data set WORK.SIM_DBS2_LONG.
NOTE: The data set WORK.SIM_DBS2_LONG_T has 500 observations and 6 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

431        
432        /* Combine Stage 1 data and calculate change from baseline */
433        %combine_and_calculate_change(
434            dbs1_prefix=sim_dbs1,
435            dbs2_prefix=sim_dbs2,
436            output_data=dat_stg1
437        );

NOTE: There were 500 observations read from the data set WORK.SIM_DBS1_LONG_T.
NOTE: There were 500 observations read from the data set WORK.SIM_DBS2_LONG_T.
NOTE: The data set WORK.SIM_DBS_LONG_T_COMB has 1000 observations and 6 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      


NOTE: There were 1000 observations read from the data set WORK.SIM_DBS_LONG_T_COMB.
NOTE: The data set WORK.SIM_DBS_LONG_T_BSL has 100 observations and 6 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.00 seconds
      


NOTE: There were 1000 observations read from the data set WORK.SIM_DBS_LONG_T_COMB.
NOTE: The data set WORK.SIM_DBS_LONG_T_COMB has 1000 observations and 6 variables.
12                                        The SAS System           15:51 Monday, September 22, 2025

NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


NOTE: There were 100 observations read from the data set WORK.SIM_DBS_LONG_T_BSL.
NOTE: The data set WORK.SIM_DBS_LONG_T_BSL has 100 observations and 6 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


NOTE: There were 1000 observations read from the data set WORK.SIM_DBS_LONG_T_COMB.
NOTE: There were 100 observations read from the data set WORK.SIM_DBS_LONG_T_BSL.
NOTE: The data set WORK.SIM_DBS_LONG_T_COMB_BSL has 1000 observations and 7 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      


NOTE: There were 1000 observations read from the data set WORK.SIM_DBS_LONG_T_COMB_BSL.
NOTE: The data set WORK.DAT_STG1 has 1000 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      


NOTE: There were 1000 observations read from the data set WORK.DAT_STG1.
NOTE: The data set WORK.DAT_STG1 has 1000 observations and 8 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      

NOTE: Deleting WORK.SIM_DBS_LONG_T_COMB (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS_LONG_T_BSL (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS_LONG_T_COMB_BSL (memtype=DATA).
NOTE: PROCEDURE DELETE used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

438        
439        /* Clean up intermediate Stage 1 datasets */
440        proc delete data=sim_dbs1 sim_dbs2
441                         sim_dbs1_sid sim_dbs2_sid
442                         sim_dbs1_long sim_dbs2_long
443                         sim_dbs1_long_t sim_dbs2_long_t;
444        run;
13                                        The SAS System           15:51 Monday, September 22, 2025


NOTE: Deleting WORK.SIM_DBS1 (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS2 (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS1_SID (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS2_SID (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS1_LONG (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS2_LONG (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS1_LONG_T (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS2_LONG_T (memtype=DATA).
NOTE: PROCEDURE DELETE used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

445        
446        /* Sort for mixed model analysis */
447        proc sort data=dat_stg1;
448            by iterID SID trt t;
449        run;

NOTE: There were 1000 observations read from the data set WORK.DAT_STG1.
NOTE: The data set WORK.DAT_STG1 has 1000 observations and 8 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      

450        
451        /*-----------------------------------------------------------------------------
452         * STAGE 1: MIXED MODEL ANALYSIS
453         *----------------------------------------------------------------------------*/
454        
455        /* Analyze Stage 1 data using mixed effects model with AR(1) correlation */
456        ods output LSMEstimates=est1st1a
457                   ConvergenceStatus=cs1st1a;
458        
459        PROC MIXED DATA=dat_stg1;
460            by iterID;
461            CLASS SID trt(ref='1') t;
462            MODEL chg = trt t trt*t / DDFM=KR S;  /* Kenward-Roger DF method */
463            REPEATED t / SUBJECT=SID TYPE=AR(1);   /* AR(1) correlation structure */
464            lsmestimate t*trt 'W04'  /* Week 4 treatment difference */
465                0 0 0 1 0 0 0 0 0    /* Coefficients for treatment 0 at time 4 */
466                0 0 0 -1 0 0 0 0 0   /* Coefficients for treatment 1 at time 4 */
467                / divisor=1 e alpha=0.05;
468        RUN;

NOTE: 100 observations are not included because of missing values.
NOTE: Convergence criteria met.
NOTE: The above message was for the following BY group:
      iterID=1
NOTE: The data set WORK.CS1ST1A has 1 observations and 5 variables.
NOTE: The data set WORK.EST1ST1A has 1 observations and 12 variables.
14                                        The SAS System           15:51 Monday, September 22, 2025

NOTE: The PROCEDURE MIXED printed pages 1-4.
NOTE: PROCEDURE MIXED used (Total process time):
      real time           0.38 seconds
      cpu time            0.03 seconds
      

469        
470        /*-----------------------------------------------------------------------------
471         * INTERIM ANALYSIS: CONDITIONAL POWER CALCULATION
472         *----------------------------------------------------------------------------*/
473        
474        /* Merge Stage 1 results with convergence status */
475        data res1a;
476            merge est1st1a cs1st1a;
477            by iterID;
478        run;

NOTE: There were 1 observations read from the data set WORK.EST1ST1A.
NOTE: There were 1 observations read from the data set WORK.CS1ST1A.
NOTE: The data set WORK.RES1A has 1 observations and 16 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

479        
480        /* Calculate conditional power and determine decision zones */
481        data res1a;
482            set res1a;
483        
484            /* Skip non-converged models */
485            if status = 1 then delete;
486        
487            /* Calculate sample sizes */
488            TotalNst1 = 2*&nst1;      /* Total Stage 1 sample size */
489            TotalNst2 = 2*&nst2;      /* Initial Stage 2 sample size */
490            TotalN = TotalNst1 + TotalNst2;
491            TotalNst2max = 2*&nmax;   /* Maximum Stage 2 sample size */
492            TotalN2new = TotalNst2;
493        
494            /* Calculate information weights (square root of information fraction) */
495            w1 = sqrt(TotalNst1/TotalN);
496            w2 = sqrt(TotalNst2/TotalN);
497            wratio = w1/w2;
498        
499            /* Convert t-statistic to z-statistic */
500            zvalt = quantile('normal', 1 - Probt/2);
501            if tValue < 0 then zValue = -zvalt;
502            if tValue >= 0 then zValue = zvalt;
503        
504            /* Calculate conditional power using current trend */
505            CondPow = 1 - probnorm(&cst2./w2 - zValue*wratio - zValue/wratio);
506            CondPow2 = 1 - probnorm(&cst2./w2 - tValue*wratio - tValue/wratio);
15                                        The SAS System           15:51 Monday, September 22, 2025

507            zCp = probit(1 - &beta.);
508        
509            /* Initialize decision zone flags */
510            futflag = 0;  /* Futility */
511            unfflag = 0;  /* Unfavorable */
512            prmflag = 0;  /* Promising */
513            favflag = 0;  /* Favorable */
514            effflag = 0;  /* Efficacious */
515        
516            /* Determine decision zone based on conditional power and Stage 1 result */
517            if CondPow < &cp1fut then do;
518                Region = "FUTILE";
519                futflag = 1;
520            end;
521            else if &cp1fut =< CondPow =< &cp1lowpz then do;
522                Region = "UNFAVO";
523                unfflag = 1;
524            end;
525            else if &cp1lowpz =< CondPow =< &cp2highpz then do;
526                Region = "PROMIS";
527                prmflag = 1;
528            end;
529            else if (CondPow > &cp2highpz) and (tValue > &cst1) then do;
530                Region = "FAVORA";
531                favflag = 1;
532            end;
533            else if (CondPow > &cp2highpz) and (tValue <= &cst1) then do;
534                Region = "EFFICA";
535                effflag = 1;
536            end;
537        
538            /* Adjust Stage 2 sample size for promising zone */
539            if Region in("PROMIS") then do;
540                TotalN2new = TotalNst2max;  /* Increase to maximum */
541            end;
542        
543            N2new = TotalN2new / 2;  /* Per-arm Stage 2 sample size */
544            TotalNfinal = TotalNst1 + TotalN2new;
545        run;

NOTE: There were 1 observations read from the data set WORK.RES1A.
NOTE: The data set WORK.RES1A has 1 observations and 37 variables.
NOTE: DATA statement used (Total process time):
      real time           0.08 seconds
      cpu time            0.00 seconds
      

546        
547        /* Clean up and rename variables */
548        data res1a;
549            set res1a;
550            drop Label DF Probt Alpha Lower Upper Reason Status pdG pdH;
551            rename Estimate = Diffst1
16                                        The SAS System           15:51 Monday, September 22, 2025

552                   StdErr = SEst1
553                   tValue = tst1
554                   zvalue = zst1;
555        run;

NOTE: There were 1 observations read from the data set WORK.RES1A.
NOTE: The data set WORK.RES1A has 1 observations and 27 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      

556        
557        /*-----------------------------------------------------------------------------
558         * STAGE 2: SIMULATION AND ANALYSIS
559         *----------------------------------------------------------------------------*/
560        
561        /* Initialize Stage 2 dataset */
562        data dat_stg2;
563            iterID = 0;
564        run;

NOTE: The data set WORK.DAT_STG2 has 1 observations and 1 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      

565        
566        /* Generate Stage 2 data for each iteration */
567        %simdatst2;

NOTE: There were 1 observations read from the data set WORK.RES1A.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


NOTE: The data set WORK.SIM_DBS1_ITER1 has 50 observations and 11 variables.
NOTE: PROCEDURE SIMNORMAL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


NOTE: There were 50 observations read from the data set WORK.SIM_DBS1_ITER1.
NOTE: The data set WORK.SIM_DBS1_ITER1_SID has 50 observations and 12 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      

17                                        The SAS System           15:51 Monday, September 22, 2025


NOTE: There were 50 observations read from the data set WORK.SIM_DBS1_ITER1_SID.
NOTE: The data set WORK.SIM_DBS1_ITER1_SID has 50 observations and 12 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      


NOTE: There were 50 observations read from the data set WORK.SIM_DBS1_ITER1_SID.
NOTE: The data set WORK.SIM_DBS1_ITER1_LONG has 500 observations and 4 variables.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
      


NOTE: There were 500 observations read from the data set WORK.SIM_DBS1_ITER1_LONG.
NOTE: The data set WORK.SIM_DBS1_ITER1_LONG_T has 500 observations and 6 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      


NOTE: The data set WORK.SIM_DBS2_ITER1 has 50 observations and 11 variables.
NOTE: PROCEDURE SIMNORMAL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


NOTE: There were 50 observations read from the data set WORK.SIM_DBS2_ITER1.
NOTE: The data set WORK.SIM_DBS2_ITER1_SID has 50 observations and 12 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


NOTE: There were 50 observations read from the data set WORK.SIM_DBS2_ITER1_SID.
NOTE: The data set WORK.SIM_DBS2_ITER1_SID has 50 observations and 12 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      


NOTE: There were 50 observations read from the data set WORK.SIM_DBS2_ITER1_SID.
NOTE: The data set WORK.SIM_DBS2_ITER1_LONG has 500 observations and 4 variables.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.03 seconds
      cpu time            0.00 seconds
18                                        The SAS System           15:51 Monday, September 22, 2025

      


NOTE: There were 500 observations read from the data set WORK.SIM_DBS2_ITER1_LONG.
NOTE: The data set WORK.SIM_DBS2_ITER1_LONG_T has 500 observations and 6 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      


NOTE: There were 500 observations read from the data set WORK.SIM_DBS1_ITER1_LONG_T.
NOTE: There were 500 observations read from the data set WORK.SIM_DBS2_ITER1_LONG_T.
NOTE: The data set WORK.SIM_DBS_LONG_T_COMB has 1000 observations and 6 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      


NOTE: There were 1000 observations read from the data set WORK.SIM_DBS_LONG_T_COMB.
NOTE: The data set WORK.SIM_DBS_LONG_T_BSL has 100 observations and 6 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      


NOTE: There were 1000 observations read from the data set WORK.SIM_DBS_LONG_T_COMB.
NOTE: The data set WORK.SIM_DBS_LONG_T_COMB has 1000 observations and 6 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      


NOTE: There were 100 observations read from the data set WORK.SIM_DBS_LONG_T_BSL.
NOTE: The data set WORK.SIM_DBS_LONG_T_BSL has 100 observations and 6 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


NOTE: There were 1000 observations read from the data set WORK.SIM_DBS_LONG_T_COMB.
NOTE: There were 100 observations read from the data set WORK.SIM_DBS_LONG_T_BSL.
NOTE: The data set WORK.SIM_DBS_LONG_T_COMB_BSL has 1000 observations and 7 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      


19                                        The SAS System           15:51 Monday, September 22, 2025

NOTE: There were 1000 observations read from the data set WORK.SIM_DBS_LONG_T_COMB_BSL.
NOTE: The data set WORK.DAT_STG2ITER1 has 1000 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      


NOTE: There were 1000 observations read from the data set WORK.DAT_STG2ITER1.
NOTE: The data set WORK.DAT_STG2ITER1 has 1000 observations and 8 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      

NOTE: Deleting WORK.SIM_DBS_LONG_T_COMB (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS_LONG_T_BSL (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS_LONG_T_COMB_BSL (memtype=DATA).
NOTE: PROCEDURE DELETE used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


NOTE: There were 1000 observations read from the data set WORK.DAT_STG2ITER1.
NOTE: The data set WORK.DAT_STG2ITER1 has 1000 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


NOTE: There were 1 observations read from the data set WORK.DAT_STG2.
NOTE: There were 1000 observations read from the data set WORK.DAT_STG2ITER1.
NOTE: The data set WORK.DAT_STG2 has 1001 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      


NOTE: Deleting WORK.DAT_STG2ITER1 (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS1_ITER1 (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS2_ITER1 (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS1_ITER1_SID (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS2_ITER1_SID (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS1_ITER1_LONG (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS2_ITER1_LONG (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS1_ITER1_LONG_T (memtype=DATA).
NOTE: Deleting WORK.SIM_DBS2_ITER1_LONG_T (memtype=DATA).
NOTE: PROCEDURE DELETE used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
20                                        The SAS System           15:51 Monday, September 22, 2025

      

568        
569        /* Remove initialization record */
570        data dat_stg2;
571            set dat_stg2;
572            if iterID = 0 then delete;
573        run;

NOTE: There were 1001 observations read from the data set WORK.DAT_STG2.
NOTE: The data set WORK.DAT_STG2 has 1000 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

574        
575        /* Sort for mixed model analysis */
576        proc sort data=dat_stg2;
577            by iterID SID trt t;
578        run;

NOTE: There were 1000 observations read from the data set WORK.DAT_STG2.
NOTE: The data set WORK.DAT_STG2 has 1000 observations and 8 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      

579        
580        /* Analyze Stage 2 data */
581        ods output LSMEstimates=est1st2a
582                   ConvergenceStatus=cs1st2a;
583        
584        PROC MIXED DATA=dat_stg2;
585            by iterID;
586            CLASS SID trt(ref='1') t;
587            MODEL chg = trt t trt*t / DDFM=KR S;
588            REPEATED t / SUBJECT=SID TYPE=AR(1);
589            lsmestimate t*trt 'W04'
590                0 0 0 1 0 0 0 0 0
591                0 0 0 -1 0 0 0 0 0
592                / divisor=1 e alpha=0.05;
593        RUN;

NOTE: 100 observations are not included because of missing values.
NOTE: Convergence criteria met.
NOTE: The above message was for the following BY group:
      iterID=1
NOTE: The data set WORK.CS1ST2A has 1 observations and 5 variables.
NOTE: The data set WORK.EST1ST2A has 1 observations and 12 variables.
NOTE: The PROCEDURE MIXED printed pages 5-8.
NOTE: PROCEDURE MIXED used (Total process time):
21                                        The SAS System           15:51 Monday, September 22, 2025

      real time           0.04 seconds
      cpu time            0.01 seconds
      

594        
595        /* Process Stage 2 results */
596        data res2a;
597            merge est1st2a cs1st2a;
598            by iterID;
599        run;

NOTE: There were 1 observations read from the data set WORK.EST1ST2A.
NOTE: There were 1 observations read from the data set WORK.CS1ST2A.
NOTE: The data set WORK.RES2A has 1 observations and 16 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      

600        
601        data res2a;
602            set res2a;
603            if status = 1 then delete;
604        run;

NOTE: There were 1 observations read from the data set WORK.RES2A.
NOTE: The data set WORK.RES2A has 1 observations and 16 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      

605        
606        data res2a;
607            set res2a;
608        
609            /* Convert to z-statistics */
610            zvalt = quantile('normal', 1 - Probt/2);
611            if tValue < 0 then zValue = -zvalt;
612            if tValue >= 0 then zValue = zvalt;
613        
614            drop Label DF Probt Alpha Lower Upper Reason Status pdG pdH;
615            rename Estimate = Diffst2
616                   StdErr = SEst2
617                   tValue = tst2
618                   zvalue = zst2;
619        run;

NOTE: There were 1 observations read from the data set WORK.RES2A.
NOTE: The data set WORK.RES2A has 1 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
22                                        The SAS System           15:51 Monday, September 22, 2025

      

620        
621        /*-----------------------------------------------------------------------------
622         * FINAL ANALYSIS: COMBINE STAGES AND CALCULATE POWER
623         *----------------------------------------------------------------------------*/
624        
625        /* Merge Stage 1 and Stage 2 results */
626        data finalres;
627            merge res1a res2a;
628            by iterID;
629        run;

NOTE: There were 1 observations read from the data set WORK.RES1A.
NOTE: There were 1 observations read from the data set WORK.RES2A.
NOTE: The data set WORK.FINALRES has 1 observations and 31 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      

630        
631        /* Calculate combined test statistic and final power */
632        data finalres;
633            set finalres;
634        
635            /* Weighted combination of Stage 1 and Stage 2 z-statistics */
636            zCHW = w1*zst1 + w2*zst2;
637        
638            /* Determine if trial is successful */
639            power = 0;
640            if zCHW > &cst2 then power = 1;
641        
642            /* Override based on interim decision */
643            if Region in("EFFICA") then power = 1;  /* Already significant at Stage 1 */
644            if Region in("FUTILE") then power = 0;  /* Stopped for futility */
645        run;

NOTE: There were 1 observations read from the data set WORK.FINALRES.
NOTE: The data set WORK.FINALRES has 1 observations and 33 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      

646        
647        /*-----------------------------------------------------------------------------
648         * OPERATING CHARACTERISTICS: SUMMARY STATISTICS
649         *----------------------------------------------------------------------------*/
650        
651        /* Sort by region for by-group processing */
652        proc sort data=finalres;
653            by Region;
23                                        The SAS System           15:51 Monday, September 22, 2025

654        run;

NOTE: There were 1 observations read from the data set WORK.FINALRES.
NOTE: The data set WORK.FINALRES has 1 observations and 33 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      

655        
656        /* Calculate means by decision region */
657        proc univariate data=finalres noprint;
658            by Region;
659            var TotalNfinal CondPow futflag unfflag prmflag favflag effflag Power;
660            output out=sumres
661                   mean=TotalNfinalavg CondPowavg futflagavg unfflagavg
662                        prmflagavg favflagavg effflagavg Poweravg;
663        run;

NOTE: The data set WORK.SUMRES has 1 observations and 9 variables.
NOTE: PROCEDURE UNIVARIATE used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      

664        
665        /* Calculate overall means across all regions */
666        proc univariate data=finalres noprint;
667            var TotalNfinal CondPow futflag unfflag prmflag favflag effflag Power;
668            output out=sumresoverall
669                   mean=TotalNfinalavg CondPowavg futflagavg unfflagavg
670                        prmflagavg favflagavg effflagavg Poweravg;
671        run;

NOTE: The data set WORK.SUMRESOVERALL has 1 observations and 8 variables.
NOTE: PROCEDURE UNIVARIATE used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      

672        
673        /* Add overall label */
674        data sumresoverall;
675            set sumresoverall;
676            Region = "Overall";
677        run;

NOTE: There were 1 observations read from the data set WORK.SUMRESOVERALL.
NOTE: The data set WORK.SUMRESOVERALL has 1 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      
24                                        The SAS System           15:51 Monday, September 22, 2025


678        
679        /* Combine regional and overall summaries */
680        data oc;
681            length Region $10;
682            set sumres sumresoverall;
683        run;

NOTE: There were 1 observations read from the data set WORK.SUMRES.
NOTE: There were 1 observations read from the data set WORK.SUMRESOVERALL.
NOTE: The data set WORK.OC has 2 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

684        
685        /*-----------------------------------------------------------------------------
686         * EXPORT RESULTS TO EXCEL
687         *----------------------------------------------------------------------------*/
688        
689        /* Export operating characteristics summary */
690        proc export data=oc
691                    DBMS=xlsx
692                    OUTFILE="&output_path\&outd" replace;
693        run;

NOTE: The export data set has 2 observations and 9 variables.
NOTE: "C:\sas\kush\output\modsum_base.xlsx" file was successfully created.
NOTE: PROCEDURE EXPORT used (Total process time):
      real time           0.15 seconds
      cpu time            0.01 seconds
      

694        
695        /* Export detailed simulation results */
696        proc export data=finalres
697                    DBMS=xlsx
698                    OUTFILE="&output_path\&outd2" replace;
699        run;

NOTE: The export data set has 1 observations and 33 variables.
NOTE: "C:\sas\kush\output\modOC_base.xlsx" file was successfully created.
NOTE: PROCEDURE EXPORT used (Total process time):
      real time           0.08 seconds
      cpu time            0.03 seconds
      

700        
701        /******************************************************************************
702         * END OF PROGRAM
703         *
704         * Expected Output:
25                                        The SAS System           15:51 Monday, September 22, 2025

705         * 1. C:\sas\kush\output\modsum_base.xlsx - Summary statistics by region
706         * 2. C:\sas\kush\output\modOC_base.xlsx - Detailed simulation results
707         *
708         * Notes:
709         * - Increase 'iter' to 10,000+ for production runs
710         * - Monitor convergence rates in mixed models
711         * - Check for sufficient variability in correlation matrices
712         ******************************************************************************/

NOTE: SAS Institute Inc., SAS Campus Drive, Cary, NC USA 27513-2414
NOTE: The SAS System used:
      real time           9.64 seconds
      cpu time            1.04 seconds
      
